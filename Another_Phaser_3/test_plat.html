<!doctype html>
<html lang="en">
    <head> 
        <meta charset="UTF-8" />
        <title>test</title>
        <script src="//cdn.jsdelivr.net/npm/phaser@3.16.2/dist/phaser.js"></script>
        <style type="text/css">
            body {
                margin: 0;
            }
        </style>
    </head>

    <body>
        <div>
            thanos debug thanos debug

        </div>
        <script type="text/javascript">

            var config = {
                type: Phaser.AUTO,
                width: 1000,
                height: 600,
                inputKeyboard: true,
                inputMouse: true,
                physics: {
                    default: 'arcade',
                    arcade: {
                        gravity: { y: 1400 },
                        debug: false
                    }
                },
                scene: {
                    preload: init,
                    create: render,
                    update: update
                }
            };

            var game = new Phaser.Game(config);

            function init()
            {
                //assets loaded in
                this.load.image('sky', 'assets/sky.png');
                this.load.image('ground', 'assets/concrete.png');
                this.load.image('star', 'assets/star.png');
                this.load.spritesheet('dude', 'assets/dude.png', { frameWidth: 32, frameHeight: 48 });
                //24, 48
                this.load.spritesheet('placeholder', 'assets/prototype_sprites.png', {frameWidth: 24, frameHeight: 48});
            }

            function render() 
            {
                //background image
                this.add.image(500, 300, 'sky');

                //adds platforms as a static group
                platforms = this.physics.add.staticGroup();

                //base ground
                platforms.create(500, 568, 'ground').setScale(2.5).refreshBody();

                //more platforms can be added later

                //guy, with properties and collision, frame animations below
                player = this.physics.add.sprite(100, 450, 'placeholder');
                player.setCollideWorldBounds(true);

                this.anims.create({
                    key: 'left',
                    frames: this.anims.generateFrameNumbers('placeholder', { start: 0, end: 4 }),
                    frameRate: 10,
                    repeat: -1
                });

                this.anims.create({
                    key: 'idle',
                    frames: [ { key: 'placeholder', frame: 5 } ],
                    frameRate: 20
                });

                this.anims.create({
                    key: 'right',
                    frames: this.anims.generateFrameNumbers('placeholder', { start: 6, end: 10 }),
                    frameRate: 10,
                    repeat: -1
                });

                this.anims.create({
                    key: 'fire',
                    frames: this.anims.generateFrameNumbers('placeholder', {start: 11, end: 14}),
                    frameRate: 10,
                    repeat: 4
                });

                this.anims.create({
                    key: 'jump',
                    frames: this.anims.generateFrameNumbers('placeholder', {start: 15, end: 17}),
                    frameRate: 10,
                })

                this.anims.create({
                    key: 'fall',
                    frames: this.anims.generateFrameNumbers('placeholder', {start: 18, end: 20}),
                    frameRate: 10
                })

                //set collision of dynamic objects with platforms
                this.physics.add.collider(player, platforms);

                //input detection
                keys = this.input.keyboard.addKeys('W,A,S,D,F') // keys.W, keys.A, keys.S, keys.D, etc.
                player.anims.play('idle')
                state = 0

                /*
                    state = 0; default
                    state = 1; jumping
                    state = 2; falling
                    state = 3; firing
                */
            }

            function update()
            {
                switch (state)
                {
                    case 0: 
                        state_default();
                        break;
                    case 1: 
                        state_jump();
                        break;
                    case 2:
                        state_fall();
                        break;
                    case 3:
                        state_fire();
                        break;
                    default:
                        state_default();
                }
            }

            function controls()
            {
                left = -Number(keys.A.isDown);
                right = Number(keys.D.isDown);
                player.setVelocityX((left + right)*340);
                return(left+right);
            }

            function state_default()
            {
                if (controls() < 0)
                {
                    player.anims.play('left', true);
                }
                else if (controls() > 0)
                {
                    player.anims.play('right', true);
                }
                else if(controls() == 0)
                {
                    player.anims.play('idle');
                }

                if (keys.W.isDown)
                {
                    player.setVelocityY(-660);
                    //alert(player.body.speed)
                    state = 1
                }

            }

            function state_jump()
            {
                controls()
                player.anims.play('jump')

                if (player.body.velocity.y > 0)
                {
                    state = 2
                }

                if (player.body.touching.down)
                {
                    state = 0
                }
            }

            function state_fall()
            {
                controls()
                player.anims.play('fall')

                if (player.body.touching.down)
                {
                    state = 0
                }
            }

            function state_fire()
            {

            }
        </script>
    </body>
</html>